<html>

<style>
    body {
        background-color: #101218;
        color: #cdcdcd;
    }

    main {
        flex: 1;
    }

</style>
<script>
    document.addEventListener("DOMContentLoaded", async function () {
        const response = await fetch("/status");
        const data = await response.json();
        const main = document.querySelector("main");

        for (const printerName in data.printers) {
            const printer = data.printers[printerName];
            const div = document.createElement("div");
            div.innerHTML = `<h2>${printer.name}</h2>
                             <p>Status: ${printer.status}</p>
                             <p>Time Remaining: ${printer.remainingTimeFormatted}</p>`;
            if (printer.accessToken) {
                div.innerHTML += `
                             <p>
                                Access Token: <input type="text" value="${printer.accessToken}" style="width: 300px;" />
                                <button onclick="UpdateAccessToken('${printer.name}', this.previousElementSibling.value)">Update</button>
                             </p>`;
            }
            div.innerHTML += `
                             <hr />`;
            main.appendChild(div);
        }
    });

    function UpdateAccessToken(printerName, newToken) {
        fetch(`/update-token`, {
            method: 'POST',
            body: JSON.stringify({
                printerName: printerName,
                accessToken: newToken
            }),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (response.ok) {
                alert('Access token updated successfully!');
            } else {
                alert('Failed to update access token.');
            }
        });
    }
</script>

<body>
    <div class="container">
        <main>
        </main>

        <footer>Press F5 to refresh <br /><br /></footer>
    </div>
</body>

</html>
